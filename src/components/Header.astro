---
const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/articles', label: 'Articles' },
  { href: '/signals', label: 'Signals' },
  { href: '/about', label: 'About' },
  { href: '/provenance', label: 'Provenance' },
  { href: '/contact', label: 'Contact' },
];

const currentPath = Astro.url.pathname;
---

<header class="border-b border-border-light dark:border-border-dark no-print">
  <div class="container-wide">
    <nav class="flex items-center justify-between h-16 nav:h-20">
      <!-- Logo + Wordmark -->
      <a
        href="/"
        class="flex items-center gap-2 font-serif text-lg md:text-xl font-semibold tracking-tight uppercase"
      >
        <img src="/logo.svg" alt="" class="w-6 h-6 md:w-7 md:h-7" aria-hidden="true" />
        The Machine Herald
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden nav:flex items-center gap-6">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class:list={[
              'text-sm font-medium transition-colors',
              currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href))
                ? 'text-text-primary-light dark:text-text-primary-dark'
                : 'text-text-secondary-light dark:text-text-secondary-dark hover:text-text-primary-light dark:hover:text-text-primary-dark',
            ]}
          >
            {link.label}
          </a>
        ))}

        <!-- Search Toggle -->
        <button
          type="button"
          class="p-2 rounded-lg text-text-secondary-light dark:text-text-secondary-dark hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors"
          aria-label="Search"
          data-search-open
        >
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
          </svg>
        </button>

        <!-- Theme Toggle -->
        <button
          id="theme-toggle"
          type="button"
          class="p-2 rounded-lg text-text-secondary-light dark:text-text-secondary-dark hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors"
          aria-label="Toggle dark mode"
        >
          <svg
            class="w-5 h-5 hidden dark:block"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
            />
          </svg>
          <svg
            class="w-5 h-5 block dark:hidden"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
            />
          </svg>
        </button>
      </div>

      <!-- Mobile Actions -->
      <div class="nav:hidden flex items-center gap-1">
        <button
          type="button"
          class="p-2 rounded-lg text-text-secondary-light dark:text-text-secondary-dark hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors"
          aria-label="Search"
          data-search-open
        >
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
          </svg>
        </button>
        <button
          id="mobile-menu-toggle"
          type="button"
          class="p-2 rounded-lg text-text-secondary-light dark:text-text-secondary-dark"
          aria-label="Toggle menu"
          aria-expanded="false"
        >
          <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </nav>

    <!-- Mobile Navigation -->
    <div
      id="mobile-menu"
      class="hidden nav:hidden pb-4 border-t border-border-light dark:border-border-dark"
    >
      <div class="flex flex-col gap-2 pt-4">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class:list={[
              'px-3 py-2 rounded-lg text-sm font-medium transition-colors',
              currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href))
                ? 'bg-zinc-100 dark:bg-zinc-800 text-text-primary-light dark:text-text-primary-dark'
                : 'text-text-secondary-light dark:text-text-secondary-dark',
            ]}
          >
            {link.label}
          </a>
        ))}
        <div class="flex items-center justify-end px-3 py-2">
          <div class="flex items-center gap-1">
            <button
              id="theme-toggle-mobile"
              type="button"
              class="p-2 rounded-lg text-text-secondary-light dark:text-text-secondary-dark hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors"
              aria-label="Toggle dark mode"
            >
              <svg
                class="w-5 h-5 hidden dark:block"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                />
              </svg>
              <svg
                class="w-5 h-5 block dark:hidden"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  function initHeader() {
    // Theme toggle
    const toggleTheme = () => {
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    };

    document.getElementById('theme-toggle')?.addEventListener('click', toggleTheme);
    document.getElementById('theme-toggle-mobile')?.addEventListener('click', toggleTheme);

    // Mobile menu
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');

    mobileMenuToggle?.addEventListener('click', () => {
      const isExpanded = mobileMenuToggle.getAttribute('aria-expanded') === 'true';
      mobileMenuToggle.setAttribute('aria-expanded', String(!isExpanded));
      mobileMenu?.classList.toggle('hidden');
    });
  }

  // Run on initial load
  initHeader();

  // Re-run on Astro navigation
  document.addEventListener('astro:after-swap', initHeader);
</script>
