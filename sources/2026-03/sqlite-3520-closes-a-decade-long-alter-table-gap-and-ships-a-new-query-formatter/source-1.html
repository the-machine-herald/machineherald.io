<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<base href="https://sqlite.org/forum/info">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' data:; script-src 'self' 'nonce-2620871f7b0882c0309dfaf844953db6e68026358935f96e'; style-src 'self' 'unsafe-inline'; img-src * data:">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SQLite User Forum: 3.52.0 release in approximately 3 weeks</title>
<link rel="alternate" type="application/rss+xml" title="RSS Feed"  href="/forum/timeline.rss">
<link rel="stylesheet" href="/forum/style.css?id=5f1744d2" type="text/css">
</head>
<body class="forum rpage-info cpage-info">
<header>
  <div class="title"><h1>SQLite User Forum</h1>3.52.0 release in approximately 3 weeks</div>
  <div class="status">
    <a href='/forum/login'>Login</a>

  </div>
</header>
<nav class="mainmenu" title="Main Menu">
  <a id='hbbtn' href='/forum/sitemap' aria-label='Site Map'>&#9776;</a><a href='/forum/about' class='desktoponly'>About</a>
<a href='/forum/forum' class=''>Threads</a>
<a href='/forum/forumnew' class=''>Post</a>
<a href='/forum/register' class='desktoponly'>Subscribe</a>
<a href='https://sqlite.org/' class=''>SQLite</a>

</nav>
<nav id="hbdrop" class='hbdrop' title="sitemap"></nav>
<form id='f01' method='GET' action='/forum/info'>
<input type='hidden' name='udc' value='1'>
<div class="submenu">
<a class="label sml-chronological" href="/forum/info/856056de78001d406108a56fc02c7f574f86d2bdd5ab90fe0c6a0196e72463fb?t=c">Chronological</a>
<label class='submenuctrl submenuckbox smc-unf'><input type='checkbox' name='unf' id='submenuctrl-0' >Unformatted</label>
<label class='submenuctrl submenuckbox smc-hist'><input type='checkbox' name='hist' id='submenuctrl-1' >History</label>
</div>
<input type="hidden" name="name" value="856056de78001d406108a56fc02c7f574f86d2bdd5ab90fe0c6a0196e72463fb">
</form>
<div class="content"><span id="debugMsg"></span>
<div id='forum58027' class='forumTime' >
<h1>3.52.0 release in approximately 3 weeks</h1>
<h3 class='forumPostHdr'>(1)
By Richard Hipp (drh</a>) on 2026-02-18 12:26:55
[link]</a>
[source]</a>
</h3>
<div class='forumPostBody'>
<div class="markdown">

<p>I am proposing to release SQLite version 3.52.0 in about three weeks.
See <a href="https://sqlite.org/draft/releaselog/3_52_0.html">https://sqlite.org/draft/releaselog/3_52_0.html</a> for a <em>draft</em>
of the change log.</p>

<h2 id="you-can-help">You Can Help</h2>
<p><a href="https://sqlite.org/src/rchvdwnld/trunk">Download</a> the latest
trunk code and test it for your use cases.  Compilation should
be as simple as:</p>

<ul>
<li><p><strong>./configure --all &amp;&amp; make</strong> &emsp; &larr; On Linux, Mac, etc.</p></li>
<li><p><strong>make</strong> &emsp; &larr; On Windows</p></li>
</ul>

<p>Report any problems or concerns as follow-ups to this post, or by private
email to me at drh at sqlite dot org.</p>

</div>

</div>
<div class="forumpost-single-controls"><form action="/forum/forumedit" method="POST">
<input type="hidden" name="fpid" value="1fd0249b7a493004eb0589329b39ce86b4d362120eca000fc5558624030d9dc8">
<input type="submit" name="reply" value="Reply">
<input type="hidden" name="csrf" value="X4NxUm8fHjwVYdN">
</form>
</div>
</div>
<div id='forum58037' class='forumTime' style='margin-left:4ex;'>
<h3 class='forumPostHdr'>(2.4)
By Gerry Snyder (GSnyder</a>) on 2026-02-18 15:50:18 edited from 2.3</a>
in reply to 1</a>
[link]</a>
[source]</a>
</h3>
<div class='forumPostBody'>
<div class="markdown">

<p>I like the new format method in the TCL interface. </p>

<p>Looks really nice with the default options. Have not tried overriding any of them.</p>

<p>Hmmm, trying it on a bigger table, the separator character is replaced by:   â”‚  in three places, and I cannot find anything unusual with my data at those places.</p>

<p>I have emailed a copy of the offending table to drh.</p>

</div>

</div>
<div class="forumpost-single-controls"><form action="/forum/forumedit" method="POST">
<input type="hidden" name="fpid" value="bc50b3c34b8f4fcc9fa8abfa90ded347f7839d95942ceb0d5a424649143d9a4b">
<input type="submit" name="reply" value="Reply">
<input type="hidden" name="csrf" value="X4NxUm8fHjwVYdN">
</form>
</div>
</div>
<div id='forum58034' class='forumTime' style='margin-left:4ex;'>
<h3 class='forumPostHdr'>(3)
By Roger Binns (rogerbinns</a>) on 2026-02-18 14:42:06
in reply to 1</a>
[link]</a>
[source]</a>
</h3>
<div class='forumPostBody'>
<div class="markdown">

<p><code>sqlite3_carray_bind_v2</code> is not mentioned in the release notes.</p>

<p>There was a <a href="https://sqlite.org/src/timeline?r=changegroup-change-api">session changegroup branch</a> that doesn't appear to have been merged.</p>

</div>

</div>
<div class="forumpost-single-controls"><form action="/forum/forumedit" method="POST">
<input type="hidden" name="fpid" value="3943ec833bf9b893962daff331956dfa7325eb0e3ae7e6d11710d9b860eeeb2b">
<input type="submit" name="reply" value="Reply">
<input type="hidden" name="csrf" value="X4NxUm8fHjwVYdN">
</form>
</div>
</div>
<div id='forum58114' class='forumTime forumSel' style='margin-left:8ex;'>
<h3 class='forumPostHdr'>(8)
By Roger Binns (rogerbinns</a>) on 2026-02-24 13:30:12
in reply to 3</a>
[source]</a>
</h3>
<div class='forumPostBody'>
<div class="markdown">

<p>Reminder: <code>sqlite3_carray_bind_v2</code> is not mentioned in the draft release notes.</p>

</div>

</div>
<div class="forumpost-single-controls"><form action="/forum/forumedit" method="POST">
<input type="hidden" name="fpid" value="856056de78001d406108a56fc02c7f574f86d2bdd5ab90fe0c6a0196e72463fb">
<input type="submit" name="reply" value="Reply">
<input type="hidden" name="csrf" value="X4NxUm8fHjwVYdN">
</form>
</div>
</div>
<div id='forum58045' class='forumTime' style='margin-left:4ex;'>
<h3 class='forumPostHdr'>(4)
By Mike Swanson (chungy</a>) on 2026-02-18 23:18:44
in reply to 1</a>
[link]</a>
[source]</a>
</h3>
<div class='forumPostBody'>
<div class="markdown">

<p>I have suggested proof-reading changes to the releaselog:</p>

<blockquote>
<pre><code>Index: pages/changes.in
==================================================================
--- pages/changes.in	
+++ pages/changes.in	
@@ -53,19 +53,19 @@
      &lt;li&gt; The default output mode for interactive CLI sessions now uses
           QRF to display query results in boxes formed using Unicode
           box-drawing characters, for improved legibility.  Batch CLI
           sessions use the legacy output format for compatibility.
      &lt;li&gt; Bare (unquoted) semicolons at the end of [dot-commands] are
-          silently ignored. &amp;emsp;&amp;larr;&amp;nbsp;Potentially incompatibility!
+          silently ignored. &amp;emsp;&amp;larr;&amp;nbsp;Potential incompatibility!
      &lt;li&gt; Fix the .testcase and .check commands so that they actually
           work, and use those commands in scripts that part of
           the standard SQLite test suite included with the source tree.
-     &lt;li&gt; Command-line arguments that match *.sql or *.txt and that are
-          the names of non-empty files are read and interpreted as scripts
-          of SQL statements and/or [dot-commands].
+     &lt;li&gt; Command-line arguments that match *.sql or *.txt and are the
+          names of non-empty files are read and interpreted as scripts of
+          SQL statements and/or [dot-commands].
      &lt;li&gt; The argument to the &quot;.timer&quot; command can now be &quot;once&quot;, to run
-          the timer on only the next SQL statement.
+          the timer only on the next SQL statement.
      &lt;li&gt; The new &quot;--timeout S&quot; option to the &quot;.progress&quot; dot-command
           causes SQL statements to interrupt after S seconds.
      &lt;/ol&gt;
 &lt;li&gt; New C-language interfaces:
      &lt;ol type=&quot;a&quot;&gt;
@@ -88,13 +88,13 @@
           are identical apart from ASC/DESC sort-orders to be optimized using
           a single index. 
      &lt;li&gt; Allow virtual tables to optimize DISTINCT in cases where the
           result-set of a query does not exactly match the ORDER BY clause.
      &lt;/ol&gt;
-&lt;li&gt; Faster float-point &amp;harr; decimal conversions.
+&lt;li&gt; Faster floating-point &amp;harr; decimal conversions.
 &lt;li&gt; Enhance [VACUUM INTO] so that if a [URI filename] is used as the target and
-     that filename as a reserve=N query parameter with N between 0 and 255,
+     that filename has a reserve=N query parameter with N between 0 and 255,
      then the [reserve bytes|reserve amount] for the generated database copy
      is set to N.
 &lt;li&gt; Add the &quot;-p|--port&quot; option to [sqlite3_rsync].
 &lt;li&gt; Discontinue support for [https://en.wikipedia.org/wiki/Windows_RT|Windows RT].
 &lt;p&gt;&lt;b&gt;Hashes:&lt;/b&gt;

</code></pre></blockquote>

</div>

</div>
<div class="forumpost-single-controls"><form action="/forum/forumedit" method="POST">
<input type="hidden" name="fpid" value="be2d30b57de03499bf88a53f135d40ed1c29025a6afae1c000046aa2a1034a6a">
<input type="submit" name="reply" value="Reply">
<input type="hidden" name="csrf" value="X4NxUm8fHjwVYdN">
</form>
</div>
</div>
<div id='forum58065' class='forumTime' style='margin-left:4ex;'>
<h3 class='forumPostHdr'>(5)
By bucweat</a> on 2026-02-20 00:34:15
in reply to 1</a>
[link]</a>
[source]</a>
</h3>
<div class='forumPostBody'>
<div class="markdown">

<p>Hi,</p>

<p>Today I am snowed in so I took drh advice from forum post <a href="https://sqlite.org/forum/info/48144e71752f1b6b]">https://sqlite.org/forum/info/48144e71752f1b6b</a> and learned how to build the amalgamation from fossil trunk so that I could test upcoming release with ODBC driver. That actually went pretty well...no issues building amalgamation and it worked just fine :-)</p>

<p>I've noticed a difference between 3.51.2 and 3.52.0 that probably is so far down in the weeds that it is not important, but figured I mention it anyway. It has to do with rounding of least significant digits.</p>

<p>The test sql uses Keith Medcalf's SQLite <a href="https://github.com/ncruces/kmedcalf-sqlite/blob/main/sqlfcmp.c">sqlfcmp</a> extension which developers have mentioned they keep in their toolbox. The test code does not generate anything useful but it does exercise the extension and some methods contained within. The sql for this is</p>
<pre><code>.mode list
.load sqlfcmp

SELECT sqlite_version() as vers, sqlite_source_id() as srcId;

drop table if exists t;
create table t(c real);
insert into t values(100-5*ulp(100));
insert into t values(100-4*ulp(100));
insert into t values(100-3*ulp(100));
insert into t values(100-2*ulp(100));
insert into t values(100-1*ulp(100));
insert into t values(100-0*ulp(100));
insert into t values(100+1*ulp(100));
insert into t values(100+2*ulp(100));
insert into t values(100+3*ulp(100));
insert into t values(100+4*ulp(100));
insert into t values(100+5*ulp(100));

.print ****************
select &#39;c&#39;, c, format(&#39;%!.30f&#39;, c) from t;
select &#39;total(c)&#39;, total(c), format(&#39;%!.30f&#39;, total(c)) from t;

.print ****************
select &#39;ulps(100,c)&#39;,c,ulps(100,c) from t;
</code></pre>
<p>Here are results for 3.51.2</p>
<pre><code>sqlite3.exe  &lt; test.sql
3.51.2|2026-01-09 17:27:48 b270f8339eb13b504d0b2ba154ebca966b7dde08e40c3ed7d559749818cb2075
****************
c|99.9999999999999|99.9999999999999289
c|99.9999999999999|99.9999999999999432
c|100.0|99.9999999999999574
c|100.0|99.9999999999999716 &lt;-----------
c|100.0|99.9999999999999858 &lt;-----------
c|100.0|100.0
c|100.0|100.0000000000000142 &lt;-----------
c|100.0|100.0000000000000284 &lt;-----------
c|100.0|100.0000000000000426
c|100.0|100.0000000000000568
c|100.0|100.0000000000000711
total(c)|1100.0|1100.0
****************
ulps(100,c)|99.9999999999999|5.0
ulps(100,c)|99.9999999999999|4.0
ulps(100,c)|100.0|3.0
ulps(100,c)|100.0|2.0
ulps(100,c)|100.0|1.0
ulps(100,c)|100.0|0.0
ulps(100,c)|100.0|-1.0
ulps(100,c)|100.0|-2.0
ulps(100,c)|100.0|-3.0
ulps(100,c)|100.0|-4.0
ulps(100,c)|100.0|-5.0
</code></pre>
<p>Here are results for 3.52.0</p>
<pre><code>sqlite3.exe  &lt; test.sql
3.52.0|2026-02-19 12:59:42 e540f6c370675ae043af8cdbb80f7eb17c08e50f7634e0b78f0-experimental
****************
c|99.9999999999999|99.9999999999999289
c|99.9999999999999|99.9999999999999431
c|100.0|99.9999999999999573
c|100.0|99.9999999999999715 &lt;-----------
c|100.0|99.9999999999999857 &lt;-----------
c|100.0|100.0
c|100.0|100.0000000000000142 &lt;-----------
c|100.0|100.0000000000000284 &lt;-----------
c|100.0|100.0000000000000426
c|100.0|100.0000000000000568
c|100.0|100.000000000000071
total(c)|1100.0|1100.0
****************
ulps(100,c)|99.9999999999999|5.0
ulps(100,c)|99.9999999999999|4.0
ulps(100,c)|100.0|3.0
ulps(100,c)|100.0|2.0
ulps(100,c)|100.0|1.0
ulps(100,c)|100.0|0.0
ulps(100,c)|100.0|-1.0
ulps(100,c)|100.0|-2.0
ulps(100,c)|100.0|-3.0
ulps(100,c)|100.0|-4.0
ulps(100,c)|100.0|-5.0
</code></pre>
<p><a href="https://sqlite.org/forum/forumpost/83a5dbd221ecec65">This post</a> by @jchd18 provides some higher precision values for ULPs around 100:
<pre><code>PrePrevious  = +99.999999999999971578290569595992565155029296875
Previous     = +99.9999999999999857891452847979962825775146484375
Value        = +100
Next         = +100.0000000000000142108547152020037174224853515625
NextNext     = +100.000000000000028421709430404007434844970703125
</code></pre></p>

<p>If you compare these higher precision values to the values generated by the query (with the  &lt;-----------) it would seem like the 3.52.0 is not rounding the value but instead clipping the digits to the left of displayed lsb. 3.52.2 appears to do the rounding correctly.</p>

</div>

</div>
<div class="forumpost-single-controls"><form action="/forum/forumedit" method="POST">
<input type="hidden" name="fpid" value="60d56f49645d97158440e3f8f03b754adb23b382d9a5cb98e61f7d6c90bcf791">
<input type="submit" name="reply" value="Reply">
<input type="hidden" name="csrf" value="X4NxUm8fHjwVYdN">
</form>
</div>
</div>
<div id='forum58086' class='forumTime' style='margin-left:4ex;'>
<h3 class='forumPostHdr'>(6)
By David Jones (vman59</a>) on 2026-02-21 12:11:51
in reply to 1</a>
[link]</a>
[source]</a>
</h3>
<div class='forumPostBody'>
<pre class='textPlain'>
The sqlite3_format_query_result() code is pretty much self contained in the ext/qrf directory, so I added 
it temporarily to a specialized command line tool I use. The control block gives a ton of knobs to twiddle,
and it took a minute to grasp the ternary scheme (1 means false) for the members commented as &quot;True to ...&quot;.
</pre>
</div>
<div class="forumpost-single-controls"><form action="/forum/forumedit" method="POST">
<input type="hidden" name="fpid" value="6cd6c080c64df4dbf19006e39b27c57d5f1632d2d429474b6f5f47aceabc1d59">
<input type="submit" name="reply" value="Reply">
<input type="hidden" name="csrf" value="X4NxUm8fHjwVYdN">
</form>
</div>
</div>
<div id='forum58088' class='forumTime' style='margin-left:8ex;'>
<h3 class='forumPostHdr'>(7)
By Bo Lindbergh (_blgl_</a>) on 2026-02-21 12:35:18
in reply to 6</a>
[link]</a>
[source]</a>
</h3>
<div class='forumPostBody'>
<div class="markdown">

<p>Doc error: the comment that explains the tri-state scheme mentions the nonexistent <code>bColumnNames</code> field.</p>

</div>

</div>
<div class="forumpost-single-controls"><form action="/forum/forumedit" method="POST">
<input type="hidden" name="fpid" value="1a4727258188e55080e1b7bcaa048be7c76ee171579928105f8ad78228aee403">
<input type="submit" name="reply" value="Reply">
<input type="hidden" name="csrf" value="X4NxUm8fHjwVYdN">
</form>
</div>
</div>
<div id='forum58118' class='forumTime' style='margin-left:4ex;'>
<h3 class='forumPostHdr'>(9)
By anonymous</a> on 2026-02-25 01:24:15
in reply to 1</a>
[link]</a>
[source]</a>
</h3>
<div class='forumPostBody'>
<pre class='textPlain'>
Typo in release log:
7. Inprovements
should be
7. Improvements
</pre>
</div>
<div class="forumpost-single-controls"><form action="/forum/forumedit" method="POST">
<input type="hidden" name="fpid" value="02d0d12c1906b32f4bf7e884359e6df4700986bfd99e904d7cb313953c093fec">
<input type="submit" name="reply" value="Reply">
<input type="hidden" name="csrf" value="X4NxUm8fHjwVYdN">
</form>
</div>
</div>
<script nonce='2620871f7b0882c0309dfaf844953db6e68026358935f96e'>/* builtin.c:637 */
(function(){
if(window.NodeList && !NodeList.prototype.forEach){NodeList.prototype.forEach = Array.prototype.forEach;}
if(!window.fossil) window.fossil={};
window.fossil.version = "2.28 [73512f45db] 2026-02-28 01:09:41 UTC";
window.fossil.rootPath = "/forum"+'/';
window.fossil.config = {projectName: "SQLite User Forum",
shortProjectName: "sqlite-forum",
projectCode: "f9ddc3a2d2f7cf9bed55631b3e5be65ef79a7dea",
/* Length of UUID hashes for display purposes. */hashDigits: 10, hashDigitsUrl: 16,
diffContextLines: 5,
editStateMarkers: {/*Symbolic markers to denote certain edit states.*/isNew:'[+]', isModified:'[*]', isDeleted:'[-]'},
confirmerButtonTicks: 3 /*default fossil.confirmer tick count.*/,
skin:{isDark: false/*true if the current skin has the 'white-foreground' detail*/}
};
window.fossil.user = {name: "guest",isAdmin: false};
if(fossil.config.skin.isDark) document.body.classList.add('fossil-dark-style');
window.fossil.page = {name:"info"};
})();
</script>
</div>
<footer>
This page was generated in about
0.009s by
Fossil 2.28 [73512f45db] 2026-02-28 01:09:41
</footer>
<script nonce="2620871f7b0882c0309dfaf844953db6e68026358935f96e">/* style.c:903 */
function debugMsg(msg){
var n = document.getElementById("debugMsg");
if(n){n.textContent=msg;}
}
</script>
<script nonce='2620871f7b0882c0309dfaf844953db6e68026358935f96e'>
/* hbmenu.js *************************************************************/
(function() {
var hbButton = document.getElementById("hbbtn");
if (!hbButton) return;
if (!document.addEventListener) return;
var panel = document.getElementById("hbdrop");
if (!panel) return;
if (!panel.style) return;
var panelBorder = panel.style.border;
var panelInitialized = false;
var panelResetBorderTimerID = 0;
var animate = panel.style.transition !== null && (typeof(panel.style.transition) == "string");
var animMS = panel.getAttribute("data-anim-ms");
if (animMS) {
animMS = parseInt(animMS);
if (isNaN(animMS) || animMS == 0)
animate = false;
else if (animMS < 0)
animMS = 400;
}
else
animMS = 400;
var panelHeight;
function calculatePanelHeight() {
panel.style.maxHeight = '';
var es   = window.getComputedStyle(panel),
edis = es.display,
epos = es.position,
evis = es.visibility;
panel.style.visibility = 'hidden';
panel.style.position   = 'absolute';
panel.style.display    = 'block';
panelHeight = panel.offsetHeight + 'px';
panel.style.display    = edis;
panel.style.position   = epos;
panel.style.visibility = evis;
}
function showPanel() {
if (panelResetBorderTimerID) {
clearTimeout(panelResetBorderTimerID);
panelResetBorderTimerID = 0;
}
if (animate) {
if (!panelInitialized) {
panelInitialized = true;
calculatePanelHeight();
panel.style.transition = 'max-height ' + animMS +
'ms ease-in-out';
panel.style.overflowY  = 'hidden';
panel.style.maxHeight  = '0';
}
setTimeout(function() {
panel.style.maxHeight = panelHeight;
panel.style.border    = panelBorder;
}, 40);
}
panel.style.display = 'block';
document.addEventListener('keydown',panelKeydown,true);
document.addEventListener('click',panelClick,false);
}
var panelKeydown = function(event) {
var key = event.which || event.keyCode;
if (key == 27) {
event.stopPropagation();
panelToggle(true);
}
};
var panelClick = function(event) {
if (!panel.contains(event.target)) {
panelToggle(true);
}
};
function panelShowing() {
if (animate) {
return panel.style.maxHeight == panelHeight;
}
else {
return panel.style.display == 'block';
}
}
function hasChildren(element) {
var childElement = element.firstChild;
while (childElement) {
if (childElement.nodeType == 1)
return true;
childElement = childElement.nextSibling;
}
return false;
}
window.addEventListener('resize',function(event) {
panelInitialized = false;
},false);
hbButton.addEventListener('click',function(event) {
event.stopPropagation();
event.preventDefault();
panelToggle(false);
},false);
function panelToggle(suppressAnimation) {
if (panelShowing()) {
document.removeEventListener('keydown',panelKeydown,true);
document.removeEventListener('click',panelClick,false);
if (animate) {
if (suppressAnimation) {
var transition = panel.style.transition;
panel.style.transition = '';
panel.style.maxHeight = '0';
panel.style.border = 'none';
setTimeout(function() {
panel.style.transition = transition;
}, 40);
}
else {
panel.style.maxHeight = '0';
panelResetBorderTimerID = setTimeout(function() {
panel.style.border = 'none';
panelResetBorderTimerID = 0;
}, animMS);
}
}
else {
panel.style.display = 'none';
}
}
else {
if (!hasChildren(panel)) {
var xhr = new XMLHttpRequest();
xhr.onload = function() {
var doc = xhr.responseXML;
if (doc) {
var sm = doc.querySelector("ul#sitemap");
if (sm && xhr.status == 200) {
panel.innerHTML = sm.outerHTML;
showPanel();
}
}
}
var url = hbButton.href + (hbButton.href.includes("?")?"&popup":"?popup")
xhr.open("GET", url);
xhr.responseType = "document";
xhr.send();
}
else {
showPanel();
}
}
}
})();
/* forum.js *************************************************************/
(function(){
function absoluteY(obj){
var top = 0;
if( obj.offsetParent ){
do{
top += obj.offsetTop;
}while( obj = obj.offsetParent );
}
return top;
}
var x = document.getElementsByClassName('forumSel');
if(x[0]){
var w = window.innerHeight;
var h = x[0].scrollHeight;
var y = absoluteY(x[0]);
if( w>h ) y = y + (h-w)/2;
if( y>0 ) window.scrollTo(0, y);
}
})();
/* fossil.bootstrap.js *************************************************************/
"use strict";
(function () {
if(typeof window.CustomEvent === "function") return false;
window.CustomEvent = function(event, params) {
if(!params) params = {bubbles: false, cancelable: false, detail: null};
const evt = document.createEvent('CustomEvent');
evt.initCustomEvent( event, !!params.bubbles, !!params.cancelable, params.detail );
return evt;
};
})();
(function(global){
const F = global.fossil;
const timestring = function f(){
if(!f.rx1){
f.rx1 = /\.\d+Z$/;
}
const d = new Date();
return d.toISOString().replace(f.rx1,'').split('T').join(' ');
};
const localTimeString = function ff(d){
if(!ff.pad){
ff.pad = (x)=>(''+x).length>1 ? x : '0'+x;
}
d || (d = new Date());
return [
d.getFullYear(),'-',ff.pad(d.getMonth()+1),
'-',ff.pad(d.getDate()),
' ',ff.pad(d.getHours()),':',ff.pad(d.getMinutes()),
':',ff.pad(d.getSeconds())
].join('');
};
F.message = function f(msg){
const args = Array.prototype.slice.call(arguments,0);
const tgt = f.targetElement;
if(args.length) args.unshift(
localTimeString()+':'
);
if(tgt){
tgt.classList.remove('error');
tgt.innerText = args.join(' ');
}
else{
if(args.length){
args.unshift('Fossil status:');
console.debug.apply(console,args);
}
}
return this;
};
F.message.targetElement =
document.querySelector('#fossil-status-bar');
if(F.message.targetElement){
F.message.targetElement.addEventListener(
'dblclick', ()=>F.message(), false
);
}
F.error = function f(msg){
const args = Array.prototype.slice.call(arguments,0);
const tgt = F.message.targetElement;
args.unshift(timestring(),'UTC:');
if(tgt){
tgt.classList.add('error');
tgt.innerText = args.join(' ');
}
else{
args.unshift('Fossil error:');
console.error.apply(console,args);
}
return this;
};
F.encodeUrlArgs = function(obj,tgtArray,fakeEncode){
if(!obj) return '';
const a = (tgtArray instanceof Array) ? tgtArray : [],
enc = fakeEncode ? (x)=>x : encodeURIComponent;
let k, i = 0;
for( k in obj ){
if(i++) a.push('&');
a.push(enc(k),'=',enc(obj[k]));
}
return a===tgtArray ? a : a.join('');
};
F.repoUrl = function(path,urlParams){
if(!urlParams) return this.rootPath+path;
const url=[this.rootPath,path];
url.push('?');
if('string'===typeof urlParams) url.push(urlParams);
else if(urlParams && 'object'===typeof urlParams){
this.encodeUrlArgs(urlParams, url);
}
return url.join('');
};
F.isObject = function(v){
return v &&
(v instanceof Object) &&
('[object Object]' === Object.prototype.toString.apply(v) );
};
F.mergeLastWins = function(){
var k, o, i;
const n = arguments.length, rc={};
for(i = 0; i < n; ++i){
if(!F.isObject(o = arguments[i])) continue;
for( k in o ){
if(o.hasOwnProperty(k)) rc[k] = o[k];
}
}
return rc;
};
F.hashDigits = function(hash,forUrl){
const n = ('number'===typeof forUrl)
? forUrl : F.config[forUrl ? 'hashDigitsUrl' : 'hashDigits'];
return ('string'==typeof hash ? hash.substr(
0, n
) : hash);
};
F.onPageLoad = function(callback){
window.addEventListener('load', callback, false);
return this;
};
F.onDOMContentLoaded = function(callback){
window.addEventListener('DOMContentLoaded', callback, false);
return this;
};
F.shortenFilename = function(name){
const a = name.split('/');
if(a.length<=2) return name;
while(a.length>2) a.shift();
return '.../'+a.join('/');
};
F.page.addEventListener = function f(eventName, callback){
if(!f.proxy){
f.proxy = document.createElement('span');
}
f.proxy.addEventListener(eventName, callback, false);
return this;
};
F.page.dispatchEvent = function(eventName, eventDetail){
if(this.addEventListener.proxy){
try{
this.addEventListener.proxy.dispatchEvent(
new CustomEvent(eventName,{detail: eventDetail})
);
}catch(e){
console.error(eventName,"event listener threw:",e);
}
}
return this;
};
F.page.setPageTitle = function(title){
const t = document.querySelector('title');
if(t) t.innerText = title;
return this;
};
F.debounce = function f(func, waitMs, immediate) {
var timeoutId;
if(!waitMs) waitMs = f.$defaultDelay;
return function() {
const context = this, args = Array.prototype.slice.call(arguments);
const later = function() {
timeoutId = undefined;
if(!immediate) func.apply(context, args);
};
const callNow = immediate && !timeoutId;
clearTimeout(timeoutId);
timeoutId = setTimeout(later, waitMs);
if(callNow) func.apply(context, args);
};
};
F.debounce.$defaultDelay = 500;
})(window);
/* fossil.dom.js *************************************************************/
"use strict";
(function(F){
const argsToArray = (a)=>Array.prototype.slice.call(a,0);
const isArray = (v)=>v instanceof Array;
const dom = {
create: function(elemType){
return document.createElement(elemType);
},
createElemFactory: function(eType){
return function(){
return document.createElement(eType);
};
},
remove: function(e){
if(e?.forEach){
e.forEach(
(x)=>x?.parentNode?.removeChild(x)
);
}else{
e?.parentNode?.removeChild(e);
}
return e;
},
clearElement: function f(e){
if(!f.each){
f.each = function(e){
if(e.forEach){
e.forEach((x)=>f(x));
return e;
}
while(e.firstChild) e.removeChild(e.firstChild);
};
}
argsToArray(arguments).forEach(f.each);
return arguments[0];
},
};
dom.splitClassList = function f(str){
if(!f.rx){
f.rx = /(\s+|\s*,\s*)/;
}
return str ? str.split(f.rx) : [str];
};
dom.div = dom.createElemFactory('div');
dom.p = dom.createElemFactory('p');
dom.code = dom.createElemFactory('code');
dom.pre = dom.createElemFactory('pre');
dom.header = dom.createElemFactory('header');
dom.footer = dom.createElemFactory('footer');
dom.section = dom.createElemFactory('section');
dom.span = dom.createElemFactory('span');
dom.strong = dom.createElemFactory('strong');
dom.em = dom.createElemFactory('em');
dom.ins = dom.createElemFactory('ins');
dom.del = dom.createElemFactory('del');
dom.label = function(forElem, text){
const rc = document.createElement('label');
if(forElem){
if(forElem instanceof HTMLElement){
forElem = this.attr(forElem, 'id');
}
if(forElem){
dom.attr(rc, 'for', forElem);
}
}
if(text) this.append(rc, text);
return rc;
};
dom.img = function(src){
const e = this.create('img');
if(src) e.setAttribute('src',src);
return e;
};
dom.a = function(href,label){
const e = this.create('a');
if(href) e.setAttribute('href',href);
if(label) e.appendChild(dom.text(true===label ? href : label));
return e;
};
dom.hr = dom.createElemFactory('hr');
dom.br = dom.createElemFactory('br');
dom.text = function(){
return document.createTextNode(argsToArray(arguments).join(''));
};
dom.button = function(label,callback){
const b = this.create('button');
if(label) b.appendChild(this.text(label));
if('function' === typeof callback){
b.addEventListener('click', callback, false);
}
return b;
};
dom.textarea = function(){
const rc = this.create('textarea');
let rows, cols, readonly;
if(1===arguments.length){
if('boolean'===typeof arguments[0]){
readonly = !!arguments[0];
}else{
rows = arguments[0];
}
}else if(arguments.length){
rows = arguments[0];
cols = arguments[1];
readonly = arguments[2];
}
if(rows) rc.setAttribute('rows',rows);
if(cols) rc.setAttribute('cols', cols);
if(readonly) rc.setAttribute('readonly', true);
return rc;
};
dom.select = dom.createElemFactory('select');
dom.option = function(value,label){
const a = arguments;
var sel;
if(1==a.length){
if(a[0] instanceof HTMLElement){
sel = a[0];
}else{
value = a[0];
}
}else if(2==a.length){
if(a[0] instanceof HTMLElement){
sel = a[0];
value = a[1];
}else{
value = a[0];
label = a[1];
}
}
else if(3===a.length){
sel = a[0];
value = a[1];
label = a[2];
}
const o = this.create('option');
if(undefined !== value){
o.value = value;
this.append(o, this.text(label || value));
}else if(undefined !== label){
this.append(o, label);
}
if(sel) this.append(sel, o);
return o;
};
dom.h = function(level){
return this.create('h'+level);
};
dom.ul = dom.createElemFactory('ul');
dom.li = function(parent){
const li = this.create('li');
if(parent) parent.appendChild(li);
return li;
};
dom.createElemFactoryWithOptionalParent = function(childType){
return function(parent){
const e = this.create(childType);
if(parent) parent.appendChild(e);
return e;
};
};
dom.table = dom.createElemFactory('table');
dom.thead = dom.createElemFactoryWithOptionalParent('thead');
dom.tbody = dom.createElemFactoryWithOptionalParent('tbody');
dom.tfoot = dom.createElemFactoryWithOptionalParent('tfoot');
dom.tr = dom.createElemFactoryWithOptionalParent('tr');
dom.td = dom.createElemFactoryWithOptionalParent('td');
dom.th = dom.createElemFactoryWithOptionalParent('th');
dom.fieldset = function(legendText){
const fs = this.create('fieldset');
if(legendText){
this.append(
fs,
(legendText instanceof HTMLElement)
? legendText
: this.append(this.legend(legendText))
);
}
return fs;
};
dom.legend = function(legendText){
const rc = this.create('legend');
if(legendText) this.append(rc, legendText);
return rc;
};
dom.append = function f(parent){
const a = argsToArray(arguments);
a.shift();
for(let i in a) {
var e = a[i];
if(isArray(e) || e.forEach){
e.forEach((x)=>f.call(this, parent,x));
continue;
}
if('string'===typeof e
|| 'number'===typeof e
|| 'boolean'===typeof e
|| e instanceof Error) e = this.text(e);
parent.appendChild(e);
}
return parent;
};
dom.input = function(type){
return this.attr(this.create('input'), 'type', type);
};
dom.checkbox = function(value, checked){
const rc = this.input('checkbox');
if(1===arguments.length && 'boolean'===typeof value){
checked = !!value;
value = undefined;
}
if(undefined !== value) rc.value = value;
if(!!checked) rc.checked = true;
return rc;
};
dom.radio = function(){
const rc = this.input('radio');
let name, value, checked;
if(1===arguments.length && 'boolean'===typeof name){
checked = arguments[0];
name = value = undefined;
}else if(2===arguments.length){
name = arguments[0];
if('boolean'===typeof arguments[1]){
checked = arguments[1];
}else{
value = arguments[1];
checked = undefined;
}
}else if(arguments.length){
name = arguments[0];
value = arguments[1];
checked = arguments[2];
}
if(name) this.attr(rc, 'name', name);
if(undefined!==value) rc.value = value;
if(!!checked) rc.checked = true;
return rc;
};
const domAddRemoveClass = function f(action,e){
if(!f.rxSPlus){
f.rxSPlus = /\s+/;
f.applyAction = function(e,a,v){
if(!e || !v
) return;
else if(e.forEach){
e.forEach((E)=>E.classList[a](v));
}else{
e.classList[a](v);
}
};
}
var i = 2, n = arguments.length;
for( ; i < n; ++i ){
let c = arguments[i];
if(!c) continue;
else if(isArray(c) ||
('string'===typeof c
&& c.indexOf(' ')>=0
&& (c = c.split(f.rxSPlus)))
|| c.forEach
){
c.forEach((k)=>k ? f.applyAction(e, action, k) : false);
}else if(c){
f.applyAction(e, action, c);
}
}
return e;
};
dom.addClass = function(e,c){
const a = argsToArray(arguments);
a.unshift('add');
return domAddRemoveClass.apply(this, a);
};
dom.removeClass = function(e,c){
const a = argsToArray(arguments);
a.unshift('remove');
return domAddRemoveClass.apply(this, a);
};
dom.toggleClass = function f(e,c){
if(e.forEach){
e.forEach((x)=>x.classList.toggle(c));
}else{
e.classList.toggle(c);
}
return e;
};
dom.hasClass = function(e,c){
return (e && e.classList) ? e.classList.contains(c) : false;
};
dom.moveTo = function(dest,e){
const n = arguments.length;
var i = 1;
const self = this;
for( ; i < n; ++i ){
e = arguments[i];
this.append(dest, e);
}
return dest;
};
dom.moveChildrenTo = function f(dest,e){
if(!f.mv){
f.mv = function(d,v){
if(d instanceof Array){
d.push(v);
if(v.parentNode) v.parentNode.removeChild(v);
}
else d.appendChild(v);
};
}
const n = arguments.length;
var i = 1;
for( ; i < n; ++i ){
e = arguments[i];
if(!e){
console.warn("Achtung: dom.moveChildrenTo() passed a falsy value at argument",i,"of",
arguments,arguments[i]);
continue;
}
if(e.forEach){
e.forEach((x)=>f.mv(dest, x));
}else{
while(e.firstChild){
f.mv(dest, e.firstChild);
}
}
}
return dest;
};
dom.replaceNode = function f(old,nu){
var i = 1, n = arguments.length;
++f.counter;
try {
for( ; i < n; ++i ){
const e = arguments[i];
if(e.forEach){
e.forEach((x)=>f.call(this,old,e));
continue;
}
old.parentNode.insertBefore(e, old);
}
}
finally{
--f.counter;
}
if(!f.counter){
old.parentNode.removeChild(old);
}
};
dom.replaceNode.counter = 0;
dom.attr = function f(e){
if(2===arguments.length) return e.getAttribute(arguments[1]);
const a = argsToArray(arguments);
if(e.forEach){
e.forEach(function(x){
a[0] = x;
f.apply(f,a);
});
return e;
}
a.shift();
while(a.length){
const key = a.shift(), val = a.shift();
if(null===val || undefined===val){
e.removeAttribute(key);
}else{
e.setAttribute(key,val);
}
}
return e;
};
const enableDisable = function f(enable){
var i = 1, n = arguments.length;
for( ; i < n; ++i ){
let e = arguments[i];
if(e.forEach){
e.forEach((x)=>f(enable,x));
}else{
e.disabled = !enable;
}
}
return arguments[1];
};
dom.enable = function(e){
const args = argsToArray(arguments);
args.unshift(true);
return enableDisable.apply(this,args);
};
dom.disable = function(e){
const args = argsToArray(arguments);
args.unshift(false);
return enableDisable.apply(this,args);
};
dom.selectOne = function(x,origin){
var src = origin || document,
e = src.querySelector(x);
if(!e){
e = new Error("Cannot find DOM element: "+x);
console.error(e, src);
throw e;
}
return e;
};
dom.flashOnce = function f(e,howLongMs,afterFlashCallback){
if(e.dataset.isBlinking){
return;
}
if(2===arguments.length && 'function' ===typeof howLongMs){
afterFlashCallback = howLongMs;
howLongMs = f.defaultTimeMs;
}
if(!howLongMs || 'number'!==typeof howLongMs){
howLongMs = f.defaultTimeMs;
}
e.dataset.isBlinking = true;
const transition = e.style.transition;
e.style.transition = "opacity "+howLongMs+"ms ease-in-out";
const opacity = e.style.opacity;
e.style.opacity = 0;
setTimeout(function(){
e.style.transition = transition;
e.style.opacity = opacity;
delete e.dataset.isBlinking;
if(afterFlashCallback) afterFlashCallback();
}, howLongMs);
return e;
};
dom.flashOnce.defaultTimeMs = 400;
dom.flashOnce.eventHandler = (event)=>dom.flashOnce(event.target)
dom.flashNTimes = function(e,n,howLongMs,afterFlashCallback){
const args = argsToArray(arguments);
args.splice(1,1);
if(arguments.length===3 && 'function'===typeof howLongMs){
afterFlashCallback = howLongMs;
howLongMs = args[1] = this.flashOnce.defaultTimeMs;
}else if(arguments.length<3){
args[1] = this.flashOnce.defaultTimeMs;
}
n = +n;
const self = this;
const cb = args[2] = function f(){
if(--n){
setTimeout(()=>self.flashOnce(e, howLongMs, f),
howLongMs+(howLongMs*0.1));
}else if(afterFlashCallback){
afterFlashCallback();
}
};
this.flashOnce.apply(this, args);
return this;
};
dom.addClassBriefly = function f(e, className, howLongMs, afterCallback){
if(arguments.length<4 && 'function'===typeof howLongMs){
afterCallback = howLongMs;
howLongMs = f.defaultTimeMs;
}else if(arguments.length<3 || !+howLongMs){
howLongMs = f.defaultTimeMs;
}
this.addClass(e, className);
setTimeout(function(){
dom.removeClass(e, className);
if(afterCallback) afterCallback();
}, howLongMs);
return this;
};
dom.addClassBriefly.defaultTimeMs = 1000;
dom.copyTextToClipboard = function(text){
if( window.clipboardData && window.clipboardData.setData ){
window.clipboardData.setData('Text',text);
return true;
}else{
const x = document.createElement("textarea");
x.style.position = 'fixed';
x.value = text;
document.body.appendChild(x);
x.select();
var rc;
try{
document.execCommand('copy');
rc = true;
}catch(err){
rc = false;
}finally{
document.body.removeChild(x);
}
return rc;
}
};
dom.copyStyle = function f(e, style){
if(e.forEach){
e.forEach((x)=>f(x, style));
return e;
}
if(style){
let k;
for(k in style){
if(style.hasOwnProperty(k)) e.style[k] = style[k];
}
}
return e;
};
dom.effectiveHeight = function f(e){
if(!e) return 0;
if(!f.measure){
f.measure = function callee(e, depth){
if(!e) return;
const m = e.getBoundingClientRect();
if(0===depth){
callee.top = m.top;
callee.bottom = m.bottom;
}else{
callee.top = m.top ? Math.min(callee.top, m.top) : callee.top;
callee.bottom = Math.max(callee.bottom, m.bottom);
}
Array.prototype.forEach.call(e.children,(e)=>callee(e,depth+1));
if(0===depth){
f.extra += callee.bottom - callee.top;
}
return f.extra;
};
}
f.extra = 0;
f.measure(e,0);
return f.extra;
};
dom.parseHtml = function(){
let childs, string, tgt;
if(1===arguments.length){
string = arguments[0];
}else if(2==arguments.length){
tgt = arguments[0];
string  = arguments[1];
}
if(string){
const newNode = new DOMParser().parseFromString(string, 'text/html');
childs = newNode.documentElement.querySelector('body');
childs = childs ? Array.prototype.slice.call(childs.childNodes, 0) : [];
}else{
childs = [];
}
return tgt ? this.moveTo(tgt, childs) : childs;
};
F.connectPagePreviewers = function f(selector,methodNamespace){
if('string'===typeof selector){
selector = document.querySelectorAll(selector);
}else if(!selector.forEach){
selector = [selector];
}
if(!methodNamespace){
methodNamespace = F.page;
}
selector.forEach(function(e){
e.addEventListener(
'click', function(r){
const eTo = '#'===e.dataset.fPreviewTo[0]
? document.querySelector(e.dataset.fPreviewTo)
: methodNamespace[e.dataset.fPreviewTo],
eFrom = '#'===e.dataset.fPreviewFrom[0]
? document.querySelector(e.dataset.fPreviewFrom)
: methodNamespace[e.dataset.fPreviewFrom],
asText = +(e.dataset.fPreviewAsText || 0);
eTo.textContent = "Fetching preview...";
methodNamespace[e.dataset.fPreviewVia](
(eFrom instanceof Function ? eFrom.call(methodNamespace) : eFrom.value),
function(r){
if(eTo instanceof Function) eTo.call(methodNamespace, r||'');
else if(!r){
dom.clearElement(eTo);
}else if(asText){
eTo.textContent = r;
}else{
dom.parseHtml(dom.clearElement(eTo), r);
}
}
);
}, false
);
});
return this;
};
return F.dom = dom;
})(window.fossil);
/* fossil.copybutton.js *************************************************************/
(function(F){
const D = F.dom;
F.copyButton = function f(e, opt){
if('string'===typeof e){
e = document.querySelector(e);
}
opt = F.mergeLastWins(f.defaultOptions, opt);
if(opt.cssClass){
D.addClass(e, opt.cssClass);
}
var srcId, srcElem;
if(opt.copyFromElement){
srcElem = opt.copyFromElement;
}else if((srcId = opt.copyFromId || e.dataset.copyFromId)){
srcElem = document.querySelector('#'+srcId);
}
const extract = opt.extractText || (
undefined===srcElem.value ? ()=>srcElem.innerText : ()=>srcElem.value
);
D.copyStyle(e, opt.style);
e.addEventListener(
'click',
function(ev){
ev.preventDefault();
ev.stopPropagation();
if(e.disabled) return;
const txt = extract.call(opt);
if(txt && D.copyTextToClipboard(txt)){
e.dispatchEvent(new CustomEvent('text-copied',{
detail: {text: txt}
}));
}
},
false
);
if('function' === typeof opt.oncopy){
e.addEventListener('text-copied', opt.oncopy, false);
}
if(e.childElementCount!=1 || e.firstChild.tagName!='SPAN'){
D.append(D.clearElement(e), D.span());
}
return e;
};
F.copyButton.defaultOptions = {
cssClass: 'copy-button',
oncopy: undefined,
style: {}
};
})(window.fossil);
/* fossil.pikchr.js *************************************************************/
(function(F){
"use strict";
const D = F.dom, P = F.pikchr = {};
P.addSrcView = function f(svg){
if(!f.hasOwnProperty('parentClick')){
f.parentClick = function(ev){
if(ev.altKey || ev.metaKey || ev.ctrlKey
|| this.classList.contains('toggle')){
this.classList.toggle('source');
ev.stopPropagation();
ev.preventDefault();
}
};
f.clickPikchrShow = function(ev){
const pId = this.dataset['pikchrid'];
if(!pId) return;
const ePikchr = this.parentNode.parentNode.querySelector('#'+pId);
if(!ePikchr) return;
ev.stopPropagation();
window.sessionStorage.setItem('pikchr-xfer', ePikchr.innerText);
};
};
if(!svg) svg = 'svg.pikchr';
if('string' === typeof svg){
document.querySelectorAll(svg).forEach((e)=>f.call(this, e));
return this;
}else if(svg.forEach){
svg.forEach((e)=>f.call(this, e));
return this;
}
if(svg.dataset.pikchrProcessed){
return this;
}
svg.dataset.pikchrProcessed = 1;
const parent = svg.parentNode.parentNode;
const srcView = parent ? svg.parentNode.nextElementSibling : undefined;
if(srcView && srcView.classList.contains('pikchr-src')){
parent.addEventListener('click', f.parentClick, false);
const eSpan = window.sessionStorage
? srcView.querySelector('span')
: undefined;
if(eSpan){
const openLink = eSpan.querySelector('a');
if(openLink){
openLink.addEventListener('click', f.clickPikchrShow, false);
eSpan.classList.remove('hidden');
}
}
}
return this;
};
})(window.fossil);
/* fossil.confirmer.js *************************************************************/
"use strict";
(function(F){
F.confirmer = function f(elem,opt){
const dbg = opt.debug
? function(){console.debug.apply(console,arguments)}
: function(){};
dbg("confirmer opt =",opt);
if(!f.Holder){
f.isInput = (e)=>/^(input|textarea)$/i.test(e.nodeName);
f.Holder = function(target,opt){
const self = this;
this.target = target;
this.opt = opt;
this.timerID = undefined;
this.state = this.states.initial;
const isInput = f.isInput(target);
const updateText = function(msg){
if(isInput) target.value = msg;
else{
const newNode = new DOMParser().parseFromString(msg, 'text/html');
let childs = newNode.documentElement.querySelector('body');
childs = childs ? Array.prototype.slice.call(childs.childNodes, 0) : [];
target.innerText = '';
childs.forEach((e)=>target.appendChild(e));
}
}
const formatCountdown = (txt, number) => txt + " ["+number+"]";
if(opt.pinSize && opt.confirmText){
const digits = (''+(opt.timeout/1000 || opt.ticks)).length;
const lblLong = formatCountdown(opt.confirmText, "00000000".substr(0,digits+1));
const w1 = parseInt(target.getBoundingClientRect().width);
updateText(lblLong);
const w2 = parseInt(target.getBoundingClientRect().width);
if(w1 || w2){
target.style.minWidth = target.style.maxWidth = (w1>w2 ? w1 : w2)+"px";
}
}
updateText(this.opt.initialText);
if(this.opt.ticks && !this.opt.ontick){
this.opt.ontick = function(tick){
updateText(formatCountdown(self.opt.confirmText,tick));
};
}
this.setClasses(false);
this.doTimeout = function() {
if(this.timerID){
clearTimeout( this.timerID );
delete this.timerID;
}
if( this.state != this.states.waiting ) {
return;
}
this.setClasses( false );
this.state = this.states.initial;
dbg("Timeout triggered.");
if( this.opt.ontick ){
try{this.opt.ontick.call(this.target, 0)}
catch(e){dbg("ontick EXCEPTION:",e)}
}
if( this.opt.ontimeout ) {
try{this.opt.ontimeout.call(this.target)}
catch(e){dbg("ontimeout EXCEPTION:",e)}
}
updateText(this.opt.initialText);
};
target.addEventListener(
'click', function(){
switch( self.state ) {
case( self.states.waiting ):
if( undefined !== self.timerID ){
clearTimeout( self.timerID );
delete self.timerID;
}
self.state = self.states.initial;
self.setClasses( false );
dbg("Confirmed");
if( self.opt.ontick ){
try{self.opt.ontick.call(self.target,0)}
catch(e){dbg("ontick EXCEPTION:",e)}
}
if( self.opt.onconfirm ){
try{self.opt.onconfirm.call(self.target)}
catch(e){dbg("onconfirm EXCEPTION:",e)}
}
updateText(self.opt.initialText);
break;
case( self.states.initial ):
if(self.opt.ticks) self.opt.currentTick = self.opt.ticks;
self.setClasses( true );
self.state = self.states.waiting;
updateText( self.opt.confirmText );
if( self.opt.onactivate ) self.opt.onactivate.call( self.target );
if( self.opt.ontick ) self.opt.ontick.call(self.target, self.opt.currentTick);
if(self.opt.timeout){
dbg("Waiting "+self.opt.timeout+"ms on confirmation...");
self.timerID =
setTimeout(()=>self.doTimeout(),self.opt.timeout );
}else if(self.opt.ticks){
dbg("Waiting on confirmation for "+self.opt.ticks
+" ticks of "+self.opt.ticktime+"ms each...");
self.timerID =
setInterval(function(){
if(0===--self.opt.currentTick) self.doTimeout();
else{
try{self.opt.ontick.call(self.target,
self.opt.currentTick)}
catch(e){dbg("ontick EXCEPTION:",e)}
}
},self.opt.ticktime);
}
break;
default:
break;
}
}, false
);
};
f.Holder.prototype = {
states:{initial: 0, waiting: 1},
setClasses: function(activated) {
if(activated) {
if( this.opt.classWaiting ) {
this.target.classList.add( this.opt.classWaiting );
}
if( this.opt.classInitial ) {
this.target.classList.remove( this.opt.classInitial );
}
}else{
if( this.opt.classInitial ) {
this.target.classList.add( this.opt.classInitial );
}
if( this.opt.classWaiting ) {
this.target.classList.remove( this.opt.classWaiting );
}
}
}
};
}
opt = F.mergeLastWins(f.defaultOpts,{
initialText: (
f.isInput(elem) ? elem.value : elem.innerHTML
) || "PLEASE SET .initialText"
},opt);
if(!opt.confirmText){
opt.confirmText = "Confirm: "+opt.initialText;
}
if(opt.ticks){
delete opt.timeout;
opt.ticks = 0 | opt.ticks;
if(opt.ticks<=0){
throw new Error("ticks must be >0");
}
if(opt.ticktime <= 0) opt.ticktime = 1000;
}else{
delete opt.ontick;
delete opt.ticks;
}
new f.Holder(elem,opt);
return this;
};
F.confirmer.defaultOpts = {
timeout:undefined,
ticks: 3,
ticktime: 998,
onconfirm: undefined,
ontimeout: undefined,
onactivate: undefined,
classInitial: '',
classWaiting: '',
debug: false
};
})(window.fossil);
/* fossil.page.forumpost.js *************************************************************/
(function(F){
"use strict";
const P = F.page, D = F.dom;
F.onPageLoad(function(){
const scrollbarIsVisible = (e)=>e.scrollHeight > e.clientHeight;
const getWidgetHandler = function(widget, contentElem){
return function(ev){
if(ev) ev.preventDefault();
const wasExpanded = widget.classList.contains('expanded');
widget.classList.toggle('expanded');
contentElem.classList.toggle('expanded');
if(wasExpanded){
contentElem.classList.add('shrunken');
contentElem.parentElement.scrollIntoView({
 behavior: 'smooth'
});
}else{
contentElem.classList.remove('shrunken');
}
return false;
};
};
document.querySelectorAll(
'div.forumTime, div.forumEdit'
).forEach(function f(forumPostWrapper){
const content = forumPostWrapper.querySelector('div.forumPostBody');
if(!content || !scrollbarIsVisible(content)) return;
const parent = content.parentElement,
widget =  D.addClass(
D.div(),
'forum-post-collapser','bottom'
),
rightTapZone = D.addClass(
D.div(),
'forum-post-collapser','right'
);
const refillTapZone = function f(){
if(!f.baseTapIndicatorHeight){
const h1 = document.querySelector('h1, h2');
f.baseTapIndicatorHeight = h1.getBoundingClientRect().height;
}
D.clearElement(rightTapZone);
var rtzHeight = parseInt(window.getComputedStyle(rightTapZone).height);
do {
D.append(rightTapZone, D.span());
rtzHeight -= f.baseTapIndicatorHeight * 8;
}while(rtzHeight>0);
};
const handlerStep1 = getWidgetHandler(widget, content);
const widgetEventHandler = ()=>{ handlerStep1(); refillTapZone(); };
content.classList.add('with-expander');
widget.addEventListener('click', widgetEventHandler, false);
var i = 0;
for( ; i < 3; ++i ) D.append(widget, D.span());
if(content.nextSibling){
forumPostWrapper.insertBefore(widget, content.nextSibling);
}else{
forumPostWrapper.appendChild(widget);
}
content.appendChild(rightTapZone);
rightTapZone.addEventListener('click', widgetEventHandler, false);
refillTapZone();
});
if(F.pikchr){
F.pikchr.addSrcView();
}
const formSubmitted = function(event){
const form = event.target;
if( form.dataset.submitted ){
event.preventDefault();
return;
}
form.dataset.submitted = '1';
setTimeout(()=>{delete form.dataset.submitted}, 7000);
return;
};
document.querySelectorAll("form").forEach(function(form){
form.addEventListener('submit',formSubmitted);
form
.querySelectorAll("input.action-close, input.action-reopen")
.forEach(function(e){
F.confirmer(e, {
confirmText: (e.classList.contains('action-reopen')
? "Confirm re-open"
: "Confirm close"),
onconfirm: ()=>form.submit()
});
});
});
});
})(window.fossil);
/* menu.js *************************************************************/
function toggle_annotation_log(){
var w = document.getElementById("annotation_log");
var x = document.forms["f01"].elements["log"].checked
w.style.display = x ? "block" : "none";
}
function submenu_onchange_submit(){
var w = document.getElementById("f01");
w.submit();
}
(function (){
for(var i=0; 1; i++){
var x = document.getElementById("submenuctrl-"+i);
if(!x) break;
if( !x.hasAttribute('data-ctrl') ){
x.onchange = submenu_onchange_submit;
}else{
var cx = x.getAttribute('data-ctrl');
if( cx=="toggle_annotation_log" ){
x.onchange = toggle_annotation_log;
}
}
}
})();
</script>
</body>
</html>
